<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Handball VR - Jeu Officiel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/super-hands@4.0.3/dist/super-hands.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.0.0/dist/aframe-extras.controls.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-animation-component@6.0.0/dist/aframe-animation-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-physics-extras@0.1.3/dist/aframe-physics-extras.min.js"></script>
  <style>
    body {margin:0;}
    .score-ui, .timer-ui, .msg-ui {position: absolute; z-index:10002;font-family:'Segoe UI',Arial,sans-serif;}
    .score-ui {top:24px; right:24px; background:#fff9; color:#0a3a74; font-size:1.2em; border-radius:10px; box-shadow:0 2px 10px #0002; padding:0.7em 1.6em; pointer-events:none;}
    .timer-ui {top:24px;left:24px;background:#fff8;border-radius:13px;box-shadow:0 2px 16px #00335511;padding:.6em 1.6em;color:#184e77;font-size:1.3em;pointer-events:none;}
    .msg-ui {left:0;right:0;top:85px;text-align:center;font-size:2em;letter-spacing:0.05em;color:#e63946;text-shadow:0 2px 20px #fff,0 0 30px #e63946aa;}
  </style>
</head>
<body>
<a-scene physics="gravity:-9.8;">
  <a-assets>
    <img id="parquet" src="https://cdn.aframe.io/a-painter/images/floor.jpg">
    <img id="filet" src="https://cdn.pixabay.com/photo/2017/09/06/19/54/net-2726429_1280.png">
    <img id="tribune" src="https://cdn.pixabay.com/photo/2016/11/29/04/17/audience-1866738_1280.jpg">
    <img id="sky" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg">
    <img id="balltex" src="https://cdn.pixabay.com/photo/2017/01/30/22/50/handball-2023531_1280.jpg">
    <audio id="applaud" src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b0e6db1.mp3" preload="auto"></audio>
    <audio id="goal" src="https://cdn.pixabay.com/audio/2022/05/17/audio_126b8e6e53.mp3" preload="auto"></audio>
    <a-asset-item id="fond-obj" src="resources/objects/fond.obj"></a-asset-item>
  </a-assets>

  <!-- Décor OBJ -->
  <a-entity obj-model="obj: resources/objects/fond.obj"
    position="-34.47695 113.66056 449.313"
    scale="10 10 10"
    material="color: #3d3d3d"
    shadow=""
    rotation="90 0 0">
  </a-entity>

  <!-- Terrain, lignes, buts, tribunes, scoreboard, etc. (identique à ta structure précédente) -->
  <!-- ... (voir code précédent pour le décor complet) ... -->

  <!-- Ballon jouable -->
  <a-sphere id="handball" class="grabbable dynamic-body" position="0 1.2 0" radius="0.23" src="#balltex"
    roughness="0.34" metalness="0.12"
    dynamic-body="mass: 0.36; linearDamping:0.07; angularDamping:0.13; restitution:0.81; friction:0.33"
    super-hands
    shadow></a-sphere>

  <!-- Joueur (caméra + mains VR/PC) -->
  <a-entity id="rig" movement-controls kinematic-body position="0 1.6 -7">
    <a-entity id="camera" camera look-controls wasd-controls="acceleration:20" position="0 0 0"></a-entity>
    <a-entity id="leftHand"
              hand-controls="hand: left; handModelStyle: highPoly; color: #e5b285"
              super-hands
              sphere-collider="objects: .grabbable"
              shadow></a-entity>
    <a-entity id="rightHand"
              hand-controls="hand: right; handModelStyle: highPoly; color: #d7a878"
              super-hands
              sphere-collider="objects: .grabbable"
              shadow></a-entity>
  </a-entity>

  <!-- Bots adverses (exemple) -->
  <a-entity id="bots"></a-entity>

  <!-- Scoreboard et timer -->
  <div class="score-ui" id="score-ui">0 - 0</div>
  <div class="timer-ui" id="timer-ui">30:00</div>
  <div class="msg-ui" id="msg-ui"></div>

  <!-- Lumières, ambiance, etc. -->
  <!-- ... -->

  <script>
    // === LOGIQUE JEU OFFICIEL SIMPLIFIÉE ===
    // Variables de score, temps, état
    let scoreA = 0, scoreB = 0, time = 30*60, timerInt = null, playing = false;
    let scoreUi = null, timerUi = null, msgUi = null;
    let ball = null, goalSound = null;
    let bots = [];

    // Lancement du jeu
    document.addEventListener('DOMContentLoaded', function () {
      scoreUi = document.getElementById('score-ui');
      timerUi = document.getElementById('timer-ui');
      msgUi = document.getElementById('msg-ui');
      ball = document.querySelector('#handball');
      goalSound = document.querySelector('#goal');
      startGame();
    });

    function startGame() {
      scoreA = 0; scoreB = 0; time = 30*60; playing = true;
      updateScore();
      updateTimer();
      msgUi.textContent = 'Coup d\'envoi !';
      resetBall();
      if (timerInt) clearInterval(timerInt);
      timerInt = setInterval(tick, 1000);
      spawnBots();
    }

    function updateScore() { scoreUi.textContent = scoreA + ' - ' + scoreB; }
    function updateTimer() {
      let min = Math.floor(time/60), sec = ("0"+(time%60)).slice(-2);
      timerUi.textContent = min+':'+sec;
    }
    function tick() {
      if (!playing) return;
      time--;
      updateTimer();
      if (time <= 0) {
        endGame();
      }
    }
    function endGame() {
      playing = false;
      clearInterval(timerInt);
      msgUi.textContent = (scoreA === scoreB) ? "Match nul !" : (scoreA > scoreB ? "Victoire équipe A !" : "Victoire équipe B !");
      setTimeout(()=>{msgUi.textContent='';startGame();}, 8000);
    }
    function resetBall() {
      ball.setAttribute('position', {x: 0, y: 1.2, z: 0});
      ball.setAttribute('velocity', {x: 0, y: 0, z: 0});
      ball.setAttribute('angularVelocity', {x: 0, y: 0, z: 0});
    }

    // Détection de but et remise en jeu
    AFRAME.registerComponent('goal-detect', {
      init: function () {
        this.el.addEventListener('collide', (e) => {
          if (!playing) return;
          if (e.detail.body.el && e.detail.body.el.id === 'handball') {
            if (this.el.id === 'goal-trigger-north') { scoreA++; }
            else if (this.el.id === 'goal-trigger-south') { scoreB++; }
            updateScore();
            if (goalSound) goalSound.play();
            msgUi.textContent = "But !";
            playing = false;
            setTimeout(() => {msgUi.textContent='';resetBall();playing = true;}, 1500);
          }
        });
      }
    });
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelector('#goal-trigger-north').setAttribute('goal-detect','');
      document.querySelector('#goal-trigger-south').setAttribute('goal-detect','');
    });

    // === BOTS (IA SIMPLE) ===
    function spawnBots() {
      // Nettoyer anciens bots
      let botsE = document.getElementById('bots');
      botsE.innerHTML = '';
      bots = [];
      // Ajoute 3 bots adverses
      for(let i=0;i<3;i++){
        let x = -2 + i*2, z = 4+Math.random()*4;
        let bot = document.createElement('a-box');
        bot.setAttribute('position', {x:x, y:1, z:z});
        bot.setAttribute('width', 0.6);
        bot.setAttribute('depth', 0.6);
        bot.setAttribute('height', 1.8);
        bot.setAttribute('color', '#1976d2');
        bot.setAttribute('dynamic-body','');
        botsE.appendChild(bot);
        bots.push(bot);
      }
      // Mouvement simple aléatoire
      setInterval(()=>{
        bots.forEach(bot=>{
          let pos = bot.getAttribute('position');
          pos.x += (Math.random()-0.5)*1.5;
          pos.z += (Math.random()-0.5)*2;
          if (pos.x<-6) pos.x=-6; if (pos.x>6) pos.x=6;
          if (pos.z<0) pos.z=0; if (pos.z>13) pos.z=13;
          bot.setAttribute('position', pos);
        });
      }, 1300);
    }
  </script>
</a-scene>
</body>
</html>
