<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Handball VR - Terrain Réaliste</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/super-hands@4.0.3/dist/super-hands.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.0.0/dist/aframe-extras.controls.min.js"></script>
  <style>
    body {margin:0;}
    .score-ui {position: absolute; top:24px; right:24px; background:#fff9; color:#0a3a74; font-family:'Segoe UI',Arial,sans-serif; font-size:1.2em; border-radius:10px; box-shadow:0 2px 10px #0002; padding:0.7em 1.6em; z-index:10002; pointer-events:none; user-select:none; text-align:right;}
    .timer-ui {position:absolute;top:24px;left:24px;z-index:10001;font-family:'Segoe UI',Arial,sans-serif;background:#fff8;border-radius:13px;box-shadow:0 2px 16px #00335511;padding:.6em 1.6em;color:#184e77;font-size:1.3em;pointer-events:none;user-select:none;}
    .msg-ui {position:absolute;left:0;right:0;top:85px;text-align:center;z-index:10010;font-family:Impact,Arial,sans-serif;font-size:2em;letter-spacing:0.05em;color:#e63946;text-shadow:0 2px 20px #fff,0 0 30px #e63946aa;}
    .help-ui {position:absolute;left:24px;bottom:24px;z-index:10001;font-family:'Segoe UI',Arial,sans-serif;background:#fff8;border-radius:13px;box-shadow:0 2px 16px #00335511;padding:1em 2em;color:#184e77;font-size:1.09em;pointer-events:none;user-select:none;line-height:1.42em;}
  </style>
  <script>
    // ... (CODE JEU INCHANGÉ, identique à la version précédente, conserve tout le JS du gameplay)
    // Pour la lisibilité, reporte ici tout le JS de la dernière version que tu as validée !
    // (Section trop longue pour être collée ici, à récupérer tel quel)
  </script>
</head>
<body>
  <a-scene physics="gravity:-9.8; restitution:0.81; friction:0.32;" background="color: #e5f6ff" loading-screen="enabled:false">
    <a-assets>
      <img id="parquet" src="https://cdn.aframe.io/a-painter/images/floor.jpg">
      <img id="tribune" src="https://cdn.pixabay.com/photo/2016/11/29/04/17/audience-1866738_1280.jpg">
      <img id="filet" src="https://cdn.pixabay.com/photo/2017/09/06/19/54/net-2726429_1280.png">
      <img id="balltex" src="https://cdn.pixabay.com/photo/2017/01/30/22/50/handball-2023531_1280.jpg">
      <img id="sky" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg">
      <audio id="goal-audio" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12e6c7b2bb.mp3"></audio>
      <audio id="ambiance" src="https://cdn.pixabay.com/audio/2022/11/16/audio_12e9c1f3c3.mp3" preload="auto"></audio>
      <audio id="applaud" src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b0e6db1.mp3" preload="auto"></audio>
    </a-assets>
    <!-- Sol parquet main court 40x20m (scale 1=1m, ici x0.35) -->
    <a-box position="0 0 0" width="14" height="0.12" depth="28" src="#parquet" repeat="7 14" color="#f7e1b5" static-body></a-box>
    <!-- Contour terrain -->
    <a-box position="0 0.065 0" width="14.4" height="0.02" depth="28.4" color="#1e90ff"></a-box>
    <!-- Lignes principales (blanches) -->
    <a-box position="0 0.07 0" width="14" height="0.01" depth="0.12" color="#fff"></a-box> <!-- milieu -->
    <a-box position="0 0.07 14" width="14" height="0.01" depth="0.12" color="#fff"></a-box> <!-- but haut -->
    <a-box position="0 0.07 -14" width="14" height="0.01" depth="0.12" color="#fff"></a-box> <!-- but bas -->
    <a-box position="7 0.07 0" width="0.12" height="0.01" depth="28" color="#fff"></a-box>
    <a-box position="-7 0.07 0" width="0.12" height="0.01" depth="28" color="#fff"></a-box>
    <!-- Surface de but (6m) avant/arrière -->
    <a-ring position="0 0.08 11.2" rotation="-90 0 0" radius-inner="2.1" radius-outer="2.17" theta-start="270" theta-length="180" color="#fae600"></a-ring>
    <a-box position="0 0.08 13.3" width="4.2" height="0.01" depth="0.13" color="#fae600"></a-box>
    <a-box position="2.1 0.08 12.25" width="0.13" height="0.01" depth="2.1" color="#fae600"></a-box>
    <a-box position="-2.1 0.08 12.25" width="0.13" height="0.01" depth="2.1" color="#fae600"></a-box>
    <a-ring position="0 0.08 -11.2" rotation="-90 0 0" radius-inner="2.1" radius-outer="2.17" theta-start="90" theta-length="180" color="#fae600"></a-ring>
    <a-box position="0 0.08 -13.3" width="4.2" height="0.01" depth="0.13" color="#fae600"></a-box>
    <a-box position="2.1 0.08 -12.25" width="0.13" height="0.01" depth="2.1" color="#fae600"></a-box>
    <a-box position="-2.1 0.08 -12.25" width="0.13" height="0.01" depth="2.1" color="#fae600"></a-box>
    <!-- Ligne des 7m -->
    <a-box position="0 0.08 9.2" width="1.2" height="0.01" depth="0.09" color="#c0392b"></a-box>
    <a-box position="0 0.08 -9.2" width="1.2" height="0.01" depth="0.09" color="#c0392b"></a-box>
    <!-- Ligne des 9m (pointillés) -->
    <a-entity>
      <a-ring position="0 0.081 9.2" rotation="-90 0 0" radius-inner="3.0" radius-outer="3.07" color="#ff9800" theta-length="180" theta-start="270" segments-theta="32" segments-phi="2" material="side:double;repeat:8 1"></a-ring>
      <a-ring position="0 0.081 -9.2" rotation="-90 0 0" radius-inner="3.0" radius-outer="3.07" color="#ff9800" theta-length="180" theta-start="90" segments-theta="32" segments-phi="2" material="side:double;repeat:8 1"></a-ring>
    </a-entity>
    <!-- Ligne de centre -->
    <a-circle position="0 0.081 0" rotation="-90 0 0" radius="0.23" color="#1976d2"></a-circle>
    <!-- Tribunes -->
    <a-plane position="0 2.7 15.4" width="14" height="5" src="#tribune" rotation="0 0 0"></a-plane>
    <a-plane position="0 2.7 -15.4" width="14" height="5" src="#tribune" rotation="0 180 0"></a-plane>
    <a-plane position="7.3 2.7 0" width="5" height="5" src="#tribune" rotation="0 -90 0"></a-plane>
    <a-plane position="-7.3 2.7 0" width="5" height="5" src="#tribune" rotation="0 90 0"></a-plane>
    <!-- Skybox gymnase -->
    <a-sky src="#sky" rotation="0 -80 0"></a-sky>
    <!-- But avant réaliste -->
    <a-box position="0 1 13.7" width="3" height="2" depth="0.18" color="#f44336" static-body></a-box>
    <a-box position="-1.5 1 13.7" width="0.13" height="2" depth="0.22" color="#f44336" static-body></a-box>
    <a-box position="1.5 1 13.7" width="0.13" height="2" depth="0.22" color="#f44336" static-body></a-box>
    <a-box position="0 2 13.7" width="3" height="0.09" depth="0.22" color="#f44336" static-body></a-box>
    <a-plane position="0 1.01 13.8" width="2.7" height="1.82" src="#filet" rotation="0 0 0" opacity="0.7"></a-plane>
    <!-- Zone de détection du but -->
    <a-box id="goal-trigger" position="0 1 13.6" width="2.6" height="1.75" depth="0.1" opacity="0" visible="false" static-body></a-box>
    <!-- But arrière décor -->
    <a-box position="0 1 -13.7" width="3" height="2" depth="0.18" color="#f44336" opacity="0.25" static-body></a-box>
    <a-plane position="0 1.01 -13.8" width="2.7" height="1.82" src="#filet" rotation="0 180 0" opacity="0.2"></a-plane>
    <!-- Scoreboard stylé -->
    <a-box position="0 3.11 11.2" width="2.8" height="0.7" depth="0.15" color="#fff8" roughness="0.4" metalness="0.7"></a-box>
    <a-entity id="scoreboard" position="0 3.18 11.2" text="value: 0 - 0; color: #1e90ff; width: 4.5; align: center; font: https://cdn.aframe.io/fonts/Exo2Bold.fnt"></a-entity>
    <!-- Gardien IA look cartoon -->
    <a-cylinder id="gardien" position="0 1 13.3" radius="0.32" height="1.8" color="#eaf05a" segments-radial="6"></a-cylinder>
    <a-sphere position="0 1.82 13.3" radius="0.19" color="#bab600"></a-sphere>
    <!-- Bot adverse look cartoon -->
    <a-cylinder id="bot" position="0 1 7" radius="0.37" height="2" color="#aad4f7" segments-radial="6"></a-cylinder>
    <a-sphere position="0 2.24 7.47" radius="0.27" color="#0a3a74"></a-sphere>
    <!-- Ballon main texture -->
    <a-sphere id="handball" class="raycastable grabbable" position="0 1.2 0" radius="0.23" src="#balltex" roughness="0.34" metalness="0.12" dynamic-body="mass: 0.36; linearDamping:0.07; angularDamping:0.13; restitution:0.81; friction:0.33" super-hands throwable goal-detect="scoreEl: #score-text" shadow="cast:true"></a-sphere>
    <!-- Rig joueur + mains VR -->
    <a-entity id="rig" position="0 1.6 -7" foot-move>
      <a-entity id="camera" camera wasd-controls look-controls position="0 0 0"></a-entity>
      <a-entity id="leftHand" hand-controls="hand: left; handModelStyle: highPoly; color: #e5b285" shadow="cast: true" super-hands raycaster="objects: .raycastable, .grabbable; showLine: true; lineColor: #228b22" line="color: #228b22; opacity: 0.8"></a-entity>
      <a-entity id="rightHand" hand-controls="hand: right; handModelStyle: highPoly; color: #d7a878" shadow="cast: true" super-hands raycaster="objects: .raycastable, .grabbable; showLine: true; lineColor: #228b22" line="color: #228b22; opacity: 0.8"></a-entity>
    </a-entity>
    <a-entity id="score-text" position="0 3.5 3" text="value: 0; color: #1e90ff; width: 4.5; align: center; font: https://cdn.aframe.io/fonts/Exo2Bold.fnt" visible="true"></a-entity>
    <!-- Lumières dynamiques -->
    <a-light type="ambient" color="#fff" intensity="0.59"></a-light>
    <a-light type="directional" color="#fffbe8" intensity="0.41" position="0 8 9" target="#bot"></a-light>
    <a-light type="spot" color="#fff4d1" intensity="0.27" position="0 7 0"></a-light>
  </a-scene>
  <audio id="ambiance-audio" src="https://cdn.pixabay.com/audio/2022/11/16/audio_12e9c1f3c3.mp3" autoplay loop></audio>
</body>
</html>
