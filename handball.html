<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Handball Ultra VR - Terrain décalé, Ballon très petit, Mains Custom</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- A-Frame et modules -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@5.0.0/dist/aframe-physics-system.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/super-hands@4.0.3/dist/super-hands.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-animation-component@6.0.0/dist/aframe-animation-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.0.0/dist/aframe-extras.controls.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-post-processing-component@2.0.3/dist/aframe-post-processing-component.min.js"></script>
  <style>
    body {margin:0;}
    .score-ui {position: absolute; top:24px; right:24px; background:#fff9; color:#0a3a74; font-family:'Segoe UI',Arial,sans-serif; font-size:1.2em; border-radius:10px; box-shadow:0 2px 10px #0002; padding:0.7em 1.6em; z-index:10002; pointer-events:none; user-select:none; text-align:right;}
    .msg-ui {position:absolute;left:0;right:0;top:80px;text-align:center;z-index:10010;font-family:Impact,Arial,sans-serif;font-size:2em;letter-spacing:0.05em;color:#e63946;text-shadow:0 2px 20px #fff,0 0 30px #e63946aa;}
    .help-ui {position:absolute;left:24px;bottom:24px;z-index:10001;font-family:'Segoe UI',Arial,sans-serif;background:#fff8;border-radius:13px;box-shadow:0 2px 16px #00335511;padding:1em 2em;color:#184e77;font-size:1.09em;pointer-events:none;user-select:none;line-height:1.42em;}
  </style>
</head>
<body>
<div class="score-ui" id="score-ui">Tirs : <span id="shots">0</span> | Buts : <span id="goals">0</span></div>
<div class="msg-ui" id="msg-ui"></div>
<div class="help-ui">
  <b>Handball Ultra VR</b><br>
  Terrain décalé à <b>41.9425 0 0</b>.<br>
  Ballon très petit (<code>scale="0.009 0.009 0.009"</code>).<br>
  Mains VR avec modèle custom, ray, ligne et téléportation.<br>
</div>
<a-scene
  physics="gravity:-9.8;"
  post-processing="bloom: true; bloomStrength: 0.25; bloomThreshold: 0.8; bloomRadius: 0.5; ssao: true; ssaoRadius: 18; ssaoIntensity: 0.08"
  background="color: #e5f6ff"
  loading-screen="enabled:false"
  shadow="type: pcfsoft">

  <a-assets>
    <!-- Main 3D pour VR (ton modèle, orienté Z avant) -->
    <a-asset-item id="main-3d-hand" src="hand/scene.gltf"></a-asset-item>
    <!-- Ballon de handball, taille très petite -->
    <a-asset-item id="handball-ball" src="handball_1964/scene.gltf"></a-asset-item>
    <!-- Gymnase complet (terrain), positionné à 41.9425 0 0 -->
    <a-asset-item id="gymnasium" src="handball/scene.gltf"></a-asset-item>
    <!-- Sons immersifs -->
    <audio id="goal-sound" src="https://cdn.pixabay.com/audio/2022/05/17/audio_126b8e6e53.mp3" preload="auto"></audio>
    <audio id="save-sound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b0e6db1.mp3" preload="auto"></audio>
    <audio id="public" src="https://cdn.pixabay.com/audio/2022/11/16/audio_12e9c1f3c3.mp3"></audio>
    <audio id="confetti" src="https://cdn.pixabay.com/audio/2022/07/26/audio_1232a6e304.mp3"></audio>
  </a-assets>

  <!-- Gymnase (terrain) positionné à 41.9425 0 0 -->
  <a-entity gltf-model="#gymnasium" position="41.9425 0 0" scale="1 1 1" shadow="receive: true"></a-entity>

  <!-- Ballon très petit, à portée du joueur -->
  <a-entity id="handball"
    gltf-model="#handball-ball"
    position="0 1 0.6"
    scale="0.009 0.009 0.009"
    dynamic-body="mass: 0.36; restitution:0.81; friction:0.33"
    grabbable
    shadow
    obb-collider="centerModel: true"></a-entity>

  <!-- Sons d'ambiance -->
  <a-sound src="#public" position="0 2 8" spatial="true" loop="true" volume="0.6" autoplay="true"></a-sound>

  <!-- Scoreboard 3D, feedback -->
  <a-entity id="scoreboard" position="0 3.5 3.7" text="value: TIRS : 0 | BUTS : 0; color: #1e90ff; width: 5; align: center; font: https://cdn.aframe.io/fonts/Exo2Bold.fnt"></a-entity>

  <!-- Capsule collider joueur (caméra) -->
  <a-entity id="rig"
    position="0 1.7 0"
    dynamic-body="shape: capsule; height: 1.7; radius: 0.3;">
    <a-entity id="camera" camera look-controls wasd-controls position="0 0 0"></a-entity>
    <!-- MAIN GAUCHE VR avec modèle et contrôles inspirés football.html -->
    <a-entity id="leftHand"
      hand-controls="hand: left; color: #e5b285"
      shadow="cast: true"
      raycaster="objects: .raycastable; showLine: true; lineColor: #228b22"
      line="color: #228b22; opacity: 0.8"
      teleport-controls="hand: left; cameraRig: #rig; teleportOrigin: #camera; button: trigger"
      super-hands
    >
      <a-entity gltf-model="#main-3d-hand" scale="1 1 1"></a-entity>
    </a-entity>
    <!-- MAIN DROITE VR avec modèle et contrôles inspirés football.html -->
    <a-entity id="rightHand"
      hand-controls="hand: right; color: #d7a878"
      shadow="cast: true"
      raycaster="objects: .raycastable; showLine: true; lineColor: #228b22"
      line="color: #228b22; opacity: 0.8"
      teleport-controls="hand: right; cameraRig: #rig; teleportOrigin: #camera; button: trigger"
      super-hands
    >
      <a-entity gltf-model="#main-3d-hand" scale="1 1 1"></a-entity>
    </a-entity>
  </a-entity>

  <!-- Confettis -->
  <a-entity id="confetti-group" visible="false"></a-entity>

  <!-- Gardien cube simple pour repère (optionnel) -->
  <a-box id="gardien" position="0 1 7" width="0.9" height="1.8" depth="0.35" color="#eaf05a" shadow></a-box>

  <script>
    // Score & feedback UI (inchangé)
    let shots = 0, goals = 0;
    const shotsUi = document.getElementById('shots');
    const goalsUi = document.getElementById('goals');
    const msgUi = document.getElementById('msg-ui');
    function updateScore(goal) {
      shots++;
      if(goal) goals++;
      shotsUi.textContent = shots;
      goalsUi.textContent = goals;
      document.getElementById('scoreboard').setAttribute('text', 'value', `TIRS : ${shots} | BUTS : ${goals}`);
    }

    // Confettis effet (inchangé)
    function showConfetti() {
      let confetti = document.getElementById('confetti-group');
      confetti.innerHTML = '';
      confetti.setAttribute('visible', true);
      document.getElementById('confetti').play();
      for(let i=0;i<26;i++){
        let particle = document.createElement('a-sphere');
        particle.setAttribute('radius', 0.07+Math.random()*0.06);
        particle.setAttribute('color', ['#ffec40', '#e63946','#00bfff','#7cffc8','#fff'][Math.floor(Math.random()*5)]);
        particle.setAttribute('position', {x:-0.7+1.4*Math.random(), y:3.5+Math.random(), z:2.6+Math.random()*2});
        particle.setAttribute('animation__fall', `property: position; to: ${-0.7+1.4*Math.random()} 0.2 ${2.6+Math.random()*2}; dur:1200; easing:easeIn;`);
        confetti.appendChild(particle);
      }
    }
    function hideConfetti() {
      let confetti = document.getElementById('confetti-group');
      confetti.setAttribute('visible', false);
      confetti.innerHTML = '';
    }
  </script>
</a-scene>
</body>
</html>
