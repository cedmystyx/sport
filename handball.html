<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Handball Arena ‚Äì Le vrai jeu web</title>
  <meta name="description" content="Le handball web jouable, fun, extensible, solide. Pr√©vu pour des milliers de joueurs, scoring, progression, et +.">
  <link href="https://fonts.googleapis.com/css?family=Orbitron:900|Montserrat:400,700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@5.0.0/dist/aframe-physics-system.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.0.0/dist/aframe-extras.controls.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/super-hands@4.0.3/dist/super-hands.min.js"></script>
  <style>
    body {margin:0;background:#18344c;font-family:'Montserrat',Arial,sans-serif;}
    #hud, .msg-ui, .score-ui, .nav-ui {position:fixed;z-index:11000;}
    .score-ui {
      top:28px; right:34px; background:rgba(30,144,255,0.90);
      color:#fff; font-family:'Orbitron',Arial,sans-serif; font-size:1.25em; border-radius:17px 0 15px 0;
      box-shadow:0 4px 18px #1497ff44; padding:1em 2.2em; min-width:180px;
      text-align:right; border:2px solid #fff7;user-select:none;
      text-shadow:0 2px 8px #0a3a7499, 0 1px #fff5;
    }
    .msg-ui {
      left:0;right:0;top:90px;text-align:center;
      font-family:'Orbitron',Impact,Arial,sans-serif;
      font-size:2em;letter-spacing:0.08em;
      color:#1e90ff;text-shadow:0 4px 38px #fff,0 0 30px #30c6fb99, 0 2px 0 #063a5b;
      pointer-events:none;
    }
    .nav-ui {
      left:28px; bottom:28px; background:rgba(18,44,77,0.93);padding:1em 2em 1em 1.4em;
      border-radius:15px; color:#fff; font-size:1.08em; font-family:Montserrat,Arial,sans-serif;
      box-shadow:0 4px 18px #1497ff44;
    }
    .nav-ui button {font-size:1em;border-radius:0.7em;padding:0.4em 1.4em;margin:0 0.5em 0 0.2em;background:#1e90ff;color:#fff;border:none;}
    #handballOverlay {position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:12000;display:flex;align-items:center;justify-content:center;background:rgba(10,26,44,0.97);}
    .game-title {font-family:'Orbitron',Arial,sans-serif;font-size:2.8em;color:#fff;text-shadow:0 6px 32px #1497ff55, 0 2px 12px #063a5b;letter-spacing:0.09em;text-align:center;}
    .game-desc {color:#e5f6ff; font-size:1.11em; margin-top:1.3rem; margin-bottom:0.7rem;text-align:center;max-width:650px;}
    .game-btn {font-family:'Orbitron',Arial,sans-serif; font-size:1.5rem; padding:1em 2.5em;background:#1e90ff;color:#fff;border:none;border-radius:1.2em;margin-top:1.5em;}
    .game-btn:active {transform:scale(0.96);}
    @media (max-width:700px) {
      .score-ui {font-size:1em; padding:0.7em 1.2em;}
      .msg-ui {font-size:1.1em;}
      .game-title {font-size:1.3em;}
      .game-desc {font-size:0.97em;}
      .nav-ui {font-size:0.95em;}
    }
  </style>
</head>
<body>
<div class="score-ui" id="score-ui">
  <span style="font-size:1.1em;">üèê</span>
  Ballons‚ÄØ:<span id="shots" style="margin:0 0.5em 0 0.2em;font-weight:bold;">0</span>
  <span style="font-size:1.1em;">ü•Ö</span>
  Buts‚ÄØ:<span id="goals" style="margin:0 0.3em 0 0.2em;font-weight:bold;">0</span>
  <br><span style="font-size:0.9em;color:#fff8;">Combo: <span id="combo">0</span></span>
</div>
<div class="msg-ui" id="msg-ui"></div>
<div class="nav-ui" id="nav-ui">
  <button onclick="resetBall()">Reset Ballon</button>
  <button onclick="resetPlayer()">Reset Joueur</button>
  <button onclick="toggleMusic()">Musique</button>
  <button onclick="showHelp()">Aide</button>
</div>
<div id="handballOverlay">
  <div>
    <div class="game-title">Handball Arena ‚Äì Web Game</div>
    <div class="game-desc">
      <b>Simulation r√©aliste, scoring, combos, rebonds, physique solide.</b><br>
      <b>Multiplateforme VR/PC/Mobile.</b><br>
      <span style="color:#b7f;">Pr√™t pour multi, leaderboards, progression, succ√®s, bots, skins.</span>
      <br><br>
      <span style="font-style:italic;">Joue pour exploser les records, d√©fie tes amis !</span>
    </div>
    <button class="game-btn" id="startBtn">Jouer !</button>
  </div>
</div>
<a-scene physics="gravity:-9.8;" loading-screen="enabled:false" id="scene">
  <a-assets>
    <a-asset-item id="handball-ball" src="handball_1964/scene.gltf"></a-asset-item>
    <audio id="snd-goal" src="https://cdn.pixabay.com/audio/2022/07/26/audio_124bfa8c6e.mp3"></audio>
    <audio id="snd-rebound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_113b0f2b58.mp3"></audio>
    <audio id="snd-music" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12cdc1b3e1.mp3"></audio>
  </a-assets>
  <!-- D√©cor visuel infini + ambiance -->
  <a-entity environment="preset: arches; shadow: true; playArea: 1000"></a-entity>
  <!-- Sol physique immense -->
  <a-plane width="1000" height="1000" color="#eab676" position="0 0 0" rotation="-90 0 0" shadow static-body></a-plane>
  <!-- Murs physiques invisibles -->
  <a-box width="1000" height="20" depth="2" opacity="0" position="0 10 -499" static-body></a-box>
  <a-box width="1000" height="20" depth="2" opacity="0" position="0 10 499" static-body></a-box>
  <a-box width="2" height="20" depth="1000" opacity="0" position="-499 10 0" static-body></a-box>
  <a-box width="2" height="20" depth="1000" opacity="0" position="499 10 0" static-body></a-box>
  <!-- Terrain handball central exact -->
  <a-plane width="20" height="40" color="#eab676" position="0 0.04908 0" rotation="-90 0 0" shadow static-body></a-plane>
  <!-- Lignes principales -->
  <a-entity geometry="primitive: box; width: 8; height: 0.05; depth: 0.05" material="color: #fff" position="0 0.1 0"></a-entity>
  <a-entity geometry="primitive: box; width: 8; height: 0.05; depth: 0.05" material="color: #fff" position="0 0.1 -19.95"></a-entity>
  <a-entity geometry="primitive: box; width: 8; height: 0.05; depth: 0.05" material="color: #fff" position="0 0.1 19.95"></a-entity>
  <!-- Lignes touches -->
  <a-entity geometry="primitive: box; width: 0.05; height: 0.05; depth: 40" material="color: #fff" position="-4 0.1 0"></a-entity>
  <a-entity geometry="primitive: box; width: 0.05; height: 0.05; depth: 40" material="color: #fff" position="4 0.1 0"></a-entity>
  <!-- 9m arcs -->
  <a-torus arc="180" radius="9" radius-tubular="0.035" segments-radial="32" position="0 0.11 -10.95" rotation="-90 0 0" material="color: #fff;"></a-torus>
  <a-torus arc="180" radius="9" radius-tubular="0.035" segments-radial="32" position="0 0.11 10.95" rotation="-90 180 0" material="color: #fff;"></a-torus>
  <!-- 6m arcs -->
  <a-torus arc="180" radius="6" radius-tubular="0.035" segments-radial="32" position="0 0.11 -13.95" rotation="-90 0 0" material="color: #fff;"></a-torus>
  <a-torus arc="180" radius="6" radius-tubular="0.035" segments-radial="32" position="0 0.11 13.95" rotation="-90 180 0" material="color: #fff;"></a-torus>
  <!-- Points de penalty -->
  <a-cylinder radius="0.15" height="0.05" color="#fff" position="0 0.11 -16.45"></a-cylinder>
  <a-cylinder radius="0.15" height="0.05" color="#fff" position="0 0.11 16.45"></a-cylinder>
  <!-- Buts am√©lior√©s : montants, barre, filet rebondissant -->
  <a-box width="3" height="2" depth="0.12" color="#e63c3c" position="0 1 -20.06" static-body></a-box>
  <a-box width="0.12" height="2" depth="0.12" color="#e63c3c" position="-1.44 1 -20.06" static-body></a-box>
  <a-box width="0.12" height="2" depth="0.12" color="#e63c3c" position="1.44 1 -20.06" static-body></a-box>
  <a-box width="3" height="0.12" depth="0.12" color="#e63c3c" position="0 2 -20.06" static-body></a-box>
  <a-box id="goal1net" width="3" height="2" depth="0.2" color="#7fd2ff" opacity="0.19" position="0 1 -20.19" static-body="restitution:0.99"></a-box>
  <a-box width="3" height="2" depth="0.12" color="#0f82ff" position="0 1 20.06" static-body></a-box>
  <a-box width="0.12" height="2" depth="0.12" color="#0f82ff" position="-1.44 1 20.06" static-body></a-box>
  <a-box width="0.12" height="2" depth="0.12" color="#0f82ff" position="1.44 1 20.06" static-body></a-box>
  <a-box width="3" height="0.12" depth="0.12" color="#0f82ff" position="0 2 20.06" static-body></a-box>
  <a-box id="goal2net" width="3" height="2" depth="0.2" color="#7fd2ff" opacity="0.19" position="0 1 20.19" static-body="restitution:0.99"></a-box>
  <!-- Tribunes physiques -->
  <a-box width="10" height="2.5" depth="2" color="#8d9096" position="0 1.4 -22.7" opacity="0.7" static-body></a-box>
  <a-box width="10" height="2.5" depth="2" color="#8d9096" position="0 1.4 22.7" opacity="0.7" static-body></a-box>
  <a-box width="2" height="2.5" depth="45" color="#8d9096" position="-6 1.4 0" opacity="0.7" static-body></a-box>
  <a-box width="2" height="2.5" depth="45" color="#8d9096" position="6 1.4 0" opacity="0.7" static-body></a-box>
  <!-- Gradins physiques -->
  <a-box width="10" height="0.5" depth="1" color="#d0a547" position="0 0.25 -23.4" static-body></a-box>
  <a-box width="10" height="0.5" depth="1" color="#d0a547" position="0 0.25 23.4" static-body></a-box>
  <a-box width="1" height="0.5" depth="45" color="#d0a547" position="-7 0.25 0" static-body></a-box>
  <a-box width="1" height="0.5" depth="45" color="#d0a547" position="7 0.25 0" static-body></a-box>
  <!-- Ballon physique -->
  <a-entity id="handball"
    gltf-model="#handball-ball"
    position="0 1 0.8"
    scale="0.009 0.009 0.009"
    dynamic-body="shape: sphere; mass: 0.43; restitution:0.82; friction:0.34"
    grabbable
    follow-pointer
    shadow></a-entity>
  <!-- Joueur physique, movement-controls rapide, VR/PC/Mobile -->
  <a-entity id="rig"
    position="0 1.7 7"
    dynamic-body="shape: capsule; height: 1.7; radius: 0.32; mass: 85; fixedRotation: true;"
    movement-controls="speed: 28">
    <a-entity id="camera" camera look-controls></a-entity>
    <a-entity id="leftHand" hand-controls="hand: left" shadow super-hands material="color:#1e90ff;metalness:0.4;roughness:0.3;"></a-entity>
    <a-entity id="rightHand" hand-controls="hand: right" shadow super-hands material="color:#ffc107;metalness:0.4;roughness:0.3;"></a-entity>
  </a-entity>
</a-scene>
<script>
// Overlay
document.getElementById('startBtn').onclick = function() {
  document.getElementById('handballOverlay').style.display = 'none';
  document.getElementById('snd-music').play();
};
// Score UI
let shots = 0, goals = 0, combo=0, lastGoalTime=0;
const shotsUi = document.getElementById('shots');
const goalsUi = document.getElementById('goals');
const comboUi = document.getElementById('combo');
function updateScore(goal) {
  shots++;
  if(goal) {
    goals++;
    combo = (Date.now()-lastGoalTime<4500)?combo+1:1;
    lastGoalTime = Date.now();
    comboUi.textContent = combo;
    document.getElementById('msg-ui').textContent = combo>2 ? "Combo¬†!¬†üî•¬†"+combo : "But¬†!¬†ü•Öüèê";
    if(window.sndGoal) window.sndGoal.play();
  } else {
    document.getElementById('msg-ui').textContent = "";
    combo = 0; comboUi.textContent = "0";
  }
  shotsUi.textContent = shots;
  goalsUi.textContent = goals;
  setTimeout(()=>{document.getElementById('msg-ui').textContent = "";}, 1800);
}
window.sndGoal = new Audio(document.getElementById('snd-goal').src);
window.sndRebound = new Audio(document.getElementById('snd-rebound').src);
// D√©tection des buts
function detectGoal(ballPos, prevPos) {
  if(Math.abs(ballPos.x) < 1.5 && ballPos.y > 0.7 && ballPos.y < 2.2) {
    if((ballPos.z < -20 && prevPos.z >= -20) || (ballPos.z > 20 && prevPos.z <= 20)) return true;
  }
  return false;
}
// Ballon drag & scoring
AFRAME.registerComponent('follow-pointer', {
  init: function () {
    this.dragging = false; this.pointerId = null;
    this.offset = new THREE.Vector3(); this.lastPos = new THREE.Vector3();
    this.scene = this.el.sceneEl; this.el.isGrabbed = false;
    this.el.addEventListener('grab-start', () => { this.el.isGrabbed = true; });
    this.el.addEventListener('grab-end', () => { this.el.isGrabbed = false; });
    this._onDown = this.onPointerDown.bind(this);
    this._onMove = this.onPointerMove.bind(this);
    this._onUp = this.onPointerUp.bind(this);
    this.scene.addEventListener('mousedown', this._onDown);
    this.scene.addEventListener('touchstart', this._onDown);
    window.addEventListener('mousemove', this._onMove);
    window.addEventListener('touchmove', this._onMove, {passive:false});
    window.addEventListener('mouseup', this._onUp);
    window.addEventListener('touchend', this._onUp);
    this.prevBallPos = null; this.goalTimeout = false;
  },
  tick: function () {
    if(!this.el.body) return;
    const pos = this.el.object3D.position;
    if(this.prevBallPos) {
      if(detectGoal(pos, this.prevBallPos) && !this.goalTimeout) {
        updateScore(true);
        this.goalTimeout = true;
        setTimeout(()=>{this.goalTimeout=false;}, 1000);
      }
    }
    this.prevBallPos = pos.clone();
  },
  remove: function () {
    this.scene.removeEventListener('mousedown', this._onDown);
    this.scene.removeEventListener('touchstart', this._onDown);
    window.removeEventListener('mousemove', this._onMove);
    window.removeEventListener('touchmove', this._onMove);
    window.removeEventListener('mouseup', this._onUp);
    window.removeEventListener('touchend', this._onUp);
  },
  onPointerDown: function(e) {
    if(this.el.isGrabbed) return;
    let x, y;
    if(e.type.startsWith('touch')) {
      x = e.touches[0].clientX; y = e.touches[0].clientY; this.pointerId = e.touches[0].identifier;
    } else { x = e.clientX; y = e.clientY; }
    const scene = this.scene;
    const camera = scene.camera;
    const mouse = new THREE.Vector2((x / window.innerWidth)*2-1, -(y/window.innerHeight)*2+1);
    const raycaster = new THREE.Raycaster();
    raycaster.setFromCamera(mouse, camera);
    const mesh = this.el.getObject3D('mesh');
    if(!mesh) return;
    const intersects = raycaster.intersectObject(mesh,true);
    if(!intersects.length) return;
    if (scene.components['look-controls']) scene.components['look-controls'].pause();
    e.preventDefault();
    this.dragging = true;
    this.lastPos.copy(this.el.object3D.position);
    const dragPos = this.screenToWorld(x, y);
    this.offset = dragPos ? this.lastPos.clone().sub(dragPos) : new THREE.Vector3();
    if(this.el.body) {
      this.el.body.velocity.set(0,0,0); this.el.body.angularVelocity.set(0,0,0);
    }
  },
  onPointerMove: function(e) {
    if(!this.dragging) return;
    let x, y;
    if(e.type.startsWith('touch')){
      let found = false;
      for(let i=0; i<e.touches.length; i++) {
        if(e.touches[i].identifier == this.pointerId) {
          x = e.touches[i].clientX; y = e.touches[i].clientY; found=true; break;
        }
      }
      if(!found) return;
    } else { x = e.clientX; y = e.clientY; }
    const pos = this.screenToWorld(x, y);
    if(pos && this.el.body) {
      const target = pos.clone().add(this.offset);
      const delta = target.clone().sub(this.el.object3D.position);
      this.el.body.velocity.set(delta.x*16, delta.y*16, delta.z*16);
      this.lastPos.copy(this.el.object3D.position);
    }
    if(e.type.startsWith('touch')) e.preventDefault();
  },
  onPointerUp: function(e) {
    if(!this.dragging) return;
    this.dragging = false;
    if(this.scene.components['look-controls']) this.scene.components['look-controls'].play();
    this.pointerId = null;
    updateScore(false);
  },
  screenToWorld: function (x, y) {
    const scene = this.scene;
    const camera = scene.camera;
    const mouse = new THREE.Vector2((x / window.innerWidth)*2-1, -(y/window.innerHeight)*2+1);
    const raycaster = new THREE.Raycaster();
    raycaster.setFromCamera(mouse, camera);
    const planeY = 1;
    const origin = raycaster.ray.origin, dir = raycaster.ray.direction;
    if (Math.abs(dir.y) < 1e-4) return null;
    const t = (planeY - origin.y) / dir.y;
    if (t < 0) return null;
    return origin.clone().add(dir.clone().multiplyScalar(t));
  }
});
// Filet rebond sonore
AFRAME.registerComponent('net-rebound-sound', {
  init: function() {
    this.el.addEventListener('collide', function (e) {
      if(window.sndRebound) window.sndRebound.play();
    });
  }
});
document.addEventListener("DOMContentLoaded",function(){
  var net1 = document.getElementById("goal1net");
  var net2 = document.getElementById("goal2net");
  if(net1) net1.setAttribute("net-rebound-sound","");
  if(net2) net2.setAttribute("net-rebound-sound","");
});
// UI nav
function resetBall() {
  const ball = document.getElementById('handball');
  if(ball && ball.body) {
    ball.setAttribute('position','0 1 0.8');
    ball.body.position.set(0,1,0.8);
    ball.body.velocity.set(0,0,0);
    ball.body.angularVelocity.set(0,0,0);
  }
}
function resetPlayer() {
  const rig = document.getElementById('rig');
  if(rig && rig.body) {
    rig.setAttribute('position','0 1.7 7');
    rig.body.position.set(0,1.7,7);
    rig.body.velocity.set(0,0,0);
    rig.body.angularVelocity.set(0,0,0);
  }
}
let musicOn = false;
function toggleMusic() {
  const music = document.getElementById('snd-music');
  if(!music) return;
  if(musicOn) { music.pause(); music.currentTime=0; musicOn = false; }
  else { music.play(); musicOn = true; }
}
function showHelp() {
  alert("Comment jouer :\n- Clique/touche/drag le ballon pour le d√©placer ou tirer.\n- Bouge le joueur avec ZQSD ou ton joystick.\n- Marque un max de buts, tente les combos, amuse-toi !\n- Physique et rebonds r√©els.\n- Pr√™t pour le mode multijoueur, skins, classement, bots et plus encore.");
}
</script>
</body>
</html>
