<!-- Cormon VR Experience - Virtual Reality on the Modern Web
     Copyright (C) 2023-2024  Yanis M., Matthieu Farcot
     Licensed under AGPL v3.0
-->
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <title>CormonVR</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="CormonVR : expérience immersive de découverte des sports au lycée Louis de Cormontaigne, Metz">
    <link rel="icon" href="favicon.ico">
    <!-- Modules Requiring -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.0/dist/aframe-environment-component.min.js"></script>
    <!-- Scripts personnalisés -->
    <script src="./js/main.js" defer></script>
    <script src="./js/lobby.js" defer></script>
    <link rel="stylesheet" href="style.css">
  </head>

  <body>
    <div id="loadingScreen">Chargement en cours...</div>
    <a-scene 
      cursor="rayOrigin: mouse; fuse: false" 
      raycaster="objects: .raycastable" 
      fog="far: 150"
      loading-screen="enabled:false"
      embedded
    >
      <!-- Effets de particules -->
      <a-entity position="0 2.25 -15" particle-system="preset: rain"></a-entity>

      <!-- Caméra & UI VR -->
      <a-entity position="0 1.6 0" camera look-controls="magicWindowTrackingEnabled: true; touchEnabled: true; mouseEnabled: true" renderer="sortObjects: true">
        <!-- Panneau de notification -->
        <a-entity spotinfo id="NotifPanel" position="0 0 -1.5" visible="true" geometry="primitive: plane; width: 1.5; height: 1" material="color: #333; shader: flat;" class="raycastable">
          <a-entity id="Info_Description" position="-0.52 0 0.01" text="shader: msdf; anchor: left; font: https://cdn.aframe.io/examples/ui/Viga-Regular.json; align: center; color: white; value: N/A"></a-entity>
        </a-entity>
      </a-entity>

      <!-- Contrôleurs VR & Mains -->
      <a-entity id="leftController" laser-controls="hand: left" raycaster="objects: .raycastable"></a-entity>
      <a-entity id="rightController" laser-controls="hand: right" raycaster="objects: .raycastable" line="color: #118A7E"></a-entity>
      <a-entity id="leftHand" hand-tracking-controls="hand: left; handModelStyle: highPoly" raycaster="objects: .raycastable"></a-entity>
      <a-entity id="rightHand" hand-tracking-controls="hand: right" raycaster="objects: .raycastable"></a-entity>

      <!-- Environnement -->
      <a-entity environment="preset: starry; ground: flat; lighting: none; skyType: gradient; horizonColor: #4d4d4d; skyColor: #acebff"></a-entity>
      <a-entity light="color: #ffdb6c; type: spot" position="0 6.58 -143.79" rotation="0 180 0"></a-entity>
        
      <!-- ASSETS -->
      <a-assets>
        <video id="CART_SECRET" loop preload src="./resources/videos/cart.mp4"></video>
        <video id="BACKGROUND_VIDEO" loop autoplay preload muted src="./resources/videos/cart.mp4"></video>
        <a-asset-item id="background" src="./resources/objects/fond.obj"></a-asset-item>
        <!-- Images sportives, à compléter si besoin -->
        <img id="img_1" src="./img/handball.png"/>
        <img id="img_2" src="./img/basketball.png"/>
        <img id="img_3" src="./img/athletisme.png"/>
        <img id="img_4" src="./img/ping-pong.png"/>
        <img id="moai" src="./img/football.png"/>
        <!-- Ajoute les autres images manquantes ici -->
        <a-mixin id="main" geometry="primitive: plane; width: 0.58; height: 0.82" material="color: white; shader: shadow"
          animation__scale="property: scale; to: 1.3 1.3 1.3; dur: 200; startEvents: mouseenter"
          animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave"
          animation__position="property: rotation; to: 10 0 0; dur: 200; startEvents: mouseenter"
          animation__position__reverse="property: rotation; to: 0 0 0; dur: 10; startEvents: mouseleave"
        />
        <a-mixin id="poster" position="0 0 0.005" geometry="primitive: plane; width: 0.7; height: 1.4" material="color: white; shader: flat" />
      </a-assets>

      <!-- UI principale / Menu sport -->
      <a-entity id="ui" position="0 1.6 -2.5">
        <a-entity id="menu">
          <a-entity id="1" position="-1.6 1.1 0" mixin="main" class="raycastable menu-button">
            <a-entity material="src: #img_1; alphaTest: 1" mixin="poster"></a-entity>
          </a-entity>
          <a-entity id="2" position="-0.8 1.1 0" mixin="main" class="raycastable menu-button">
            <a-entity material="src: #img_2; alphaTest: 1" mixin="poster"></a-entity>
          </a-entity>
          <a-entity id="3" position="0 1.1 0" mixin="main" class="raycastable menu-button">
            <a-entity material="src: #img_3; alphaTest: 1" mixin="poster"></a-entity>
          </a-entity>
          <a-entity id="4" position="0.8 1.1 0" mixin="main" class="raycastable menu-button">
            <a-entity material="src: #img_4; alphaTest: 1" mixin="poster"></a-entity>
          </a-entity>
          <!-- Ajoute les autres boutons si tu ajoutes des images -->
          <a-video src="#CART_SECRET" toggleclick position="4.4 0 -.5" visible="false" class="raycastable"></a-video>
        </a-entity>
        <!-- Bouton info (redirige) -->
        <a-entity redirect="info.html" geometry="width: 0.5; height: 0.5" position="-2.4 0 0" material="alphaTest: 1; src: ./resources/images/info.png" mixin="poster" class="raycastable"></a-entity>
        <!-- Panneau d'informations interactif -->
        <!-- ... (conserve le panneau d'info avancé si tu l'utilises dans tes scripts) -->
      </a-entity>

      <!-- Grand écran vidéo -->
      <a-video id="4K1080P" src="#BACKGROUND_VIDEO" position="2.5 86.03 -73.4" class="raycastable" material="alphaTest: 1; fog: false; blending: additive" scale="489 200 1" visible="false" volume="100" sound="src: ./resources/sounds/light.mp3; volume: 10; loop: true;"></a-video>

      <!-- Titres -->
      <a-entity anchor="center" scale=".5 .5 .01" position="0 3.7 -2.05" rotation="0 0 0" geometry="primitive: plane; width: 4.5; height: .5" material="color: #333; shader: shadow;">
        <a-text value="LYCEE LOUIS DE CORMONTAIGNE" width="7" height="1" anchor="center" align="center" font="https://cdn.aframe.io/fonts/Exo2Bold.fnt"></a-text>
      </a-entity>
      <a-entity anchor="center" scale=".5 .5 .01" position="0 3.5 -2.05" rotation="0 0 0" geometry="primitive: plane; width: 4.5; height: .5" material="color: #333; shader: shadow;" class="raycastable">
        <a-text value="METZ" width="6" height="1" anchor="center" align="center"></a-text>
      </a-entity>
      <!-- ... (autres éléments 3D, moai, etc.) -->

      <!-- Fond 3D OBJ -->
      <a-entity anchor="center" position="-3 14 -53" rotation="90 0 0" scale="100 20 100">
        <a-entity id="panorama" obj-model="obj: ./resources/objects/fond.obj" modify-materials="" position="-0.06 -0.18 -0.40" scale="0.05 0.05 0.05"></a-entity>
      </a-entity>
      <!-- Son d'ambiance -->
      <a-entity sound="src: url(./resources/sounds/do.mp3); autoplay: true; loop: true; volume: .1" position=".03 2.8 -2.2"></a-entity>

    </a-scene>

    <!-- Ecran d'aide utilisateur -->
    <div id="helpBox">
      <b>Commandes :</b> Utilisez la souris ou le doigt pour regarder autour de vous. Cliquez sur un sport pour voir plus d'infos.
    </div>
  </body>
</html>
