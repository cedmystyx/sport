<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Big Data Digital City</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-reflection-component@^1.0.0/dist/aframe-reflection-component.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
    }
  </style>
</head>
<body>

<!-- ✅ Audio immersif futuriste -->
<audio autoplay loop>
  <source src="https://cdn.pixabay.com/audio/2023/03/07/audio_eb50a9b332.mp3" type="audio/mpeg">
</audio>

<a-scene background="color: #000">

  <!-- Caméra avec angle de vue comme dans la vidéo -->
  <a-entity id="cameraRig" position="0 3 40" rotation="-5 0 0"
    animation="property: position; to: 0 3 -300; dur: 40000; easing: linear; loop: true">
    <a-entity camera look-controls="enabled: false"></a-entity>
  </a-entity>

  <!-- Lumières -->
  <a-entity light="type: ambient; color: #88ffff; intensity: 0.6"></a-entity>
  <a-entity light="type: directional; color: #00ffff; intensity: 0.8" position="0 10 10"></a-entity>

  <!-- Sol miroir comme de l'eau -->
  <a-entity geometry="primitive: plane; width: 200; height: 1000"
            rotation="-90 0 0"
            material="color: #111"
            reflection="mirror: true; mixColor: #00ffff; mixAmount: 0.6; offset: 0.01">
  </a-entity>

  <!-- Bâtiments avec code binaire sur toutes les faces -->
  <a-entity id="city" generate-city></a-entity>

  <script>
    AFRAME.registerComponent('generate-city', {
      init: function () {
        const container = this.el;
        const binaryChars = ['0', '1'];

        for (let i = 0; i < 400; i++) {
          const x = (Math.random() - 0.5) * 80;
          const z = -i * 4 - 10;
          const h = Math.random() * 10 + 3;

          const building = document.createElement('a-entity');
          building.setAttribute('position', `${x} 0 ${z}`);

          const box = document.createElement('a-box');
          box.setAttribute('position', `0 ${h/2} 0`);
          box.setAttribute('width', '2');
          box.setAttribute('depth', '2');
          box.setAttribute('height', h.toFixed(2));
          box.setAttribute('color', '#00ffff');
          box.setAttribute('opacity', '0.6');
          building.appendChild(box);

          const faces = [
            { pos: '0 ' + h / 2 + ' 1.01', rot: '0 0 0' },     // front
            { pos: '0 ' + h / 2 + ' -1.01', rot: '0 180 0' },   // back
            { pos: '1.01 ' + h / 2 + ' 0', rot: '0 -90 0' },    // right
            { pos: '-1.01 ' + h / 2 + ' 0', rot: '0 90 0' }     // left
          ];

          faces.forEach(face => {
            const binaryPlane = document.createElement('a-plane');
            binaryPlane.setAttribute('position', face.pos);
            binaryPlane.setAttribute('rotation', face.rot);
            binaryPlane.setAttribute('width', '2');
            binaryPlane.setAttribute('height', h.toFixed(2));
            binaryPlane.setAttribute('material', 'color: #00ffff; opacity: 0.25; transparent: true');

            // Générer plusieurs lignes de petit texte binaire sur toute la hauteur
            const lineCount = Math.floor(h / 0.2);
            for (let j = 0; j < lineCount; j++) {
              const text = document.createElement('a-entity');
              text.setAttribute('text', {
                value: Array.from({length: 40}, () => binaryChars[Math.floor(Math.random() * 2)]).join(''),
                color: '#00ffff',
                align: 'center',
                width: 1.5,
                wrapCount: 40,
                baseline: 'top',
                height: 0.1
              });
              text.setAttribute('position', `0 ${(h / 2) - (j * 0.2)} 0.01`);
              binaryPlane.appendChild(text);
            }

            building.appendChild(binaryPlane);
          });

          container.appendChild(building);
        }
      }
    });
  </script>

</a-scene>

</body>
</html>
